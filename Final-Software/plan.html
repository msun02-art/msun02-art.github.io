<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FUNRUN – Plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Carlito:wght@400;700&display=swap"/>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Carlito", sans-serif;
      background: #e0e0e0;
    }

    .wrapper-main {
      width: 100%;
      min-height: 100vh;
      padding: 40px 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background-color: #e0e0e0;
    }

    .iphone-pro {
      background-color: #ffffff;
      width: 100%;
      max-width: 402px;
      min-height: 874px;
      position: relative;
      display: flex;
      flex-direction: column;
    }


    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 32px 30px 16px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .avatar-circle {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background-color: #f4ff75;
    }

    .username {
      font-size: 18px;
      color: #57a368;
      margin-top: 10px;
    }

    .top-divider {
      height: 4px;
      width: 100%;
      background-color: #57a368;
    }


    .plan-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px 8px;
      color: #57a368;
      font-size: 18px;
      font-weight: 700;
    }

    .back-home {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .back-home-arrow {
      font-size: 22px;
      line-height: 1;
    }

    .plan-title-right {
      font-size: 18px;
      font-weight: 700;
    }

    .content-scroll {
      flex: 1;
      padding: 8px 24px 120px;
      overflow-y: auto;
    }

    .calendar-card {
      margin-top: 8px;
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 18px 18px 16px;
    }

    .calendar-title {
      color: #57a368;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .calendar-month-label {
      font-size: 13px;
      color: #8aa894;
      margin-bottom: 6px;
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      font-size: 12px;
      color: #7ba47f;
      text-align: center;
      margin-bottom: 4px;
    }

    .calendar-weekdays span {
      padding: 2px 0;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      font-size: 15px;
      text-align: center;
      color: #5a7e5f;
    }

    .cal-day {
      padding: 6px 0;
      border-radius: 18px;
      background-color: #f4ff75; 
    }


    .cal-day.goal-range {
      background-color: #ffb74d;
      color: #5a3a00;
      font-weight: 600;
    }


    .cal-day.today {
      background-color: #88c4ff;
      color: #ffffff;
      font-weight: 700;
      text-decoration: none;
    }


    .section-title {
      margin-top: 28px;
      font-size: 22px;
      font-weight: 700;
      color: #57a368;
    }

    .field-row {
      margin-top: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      font-size: 16px;
      color: #4f7d56;
    }

    .field-label {
      flex: 1.1;
    }

    .field-value-box {
      flex: 1;
      background-color: #f4ff75;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 15px;
      color: #5a7e5f;
    }

    .field-input {
      flex: 1;
      background-color: #f4ff75;
      border-radius: 4px;
      border: none;
      padding: 6px 10px;
      font-size: 15px;
      color: #5a7e5f;
      outline: none;
    }

    .field-input::placeholder {
      color: #8aa894;
    }


    .update-btn-wrapper {
      margin-top: 18px;
      display: flex;
      justify-content: flex-end;
    }

    .update-btn {
      padding: 8px 18px;
      border-radius: 20px;
      border: none;
      background-color: #57a368;
      color: #f4ff75;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }


    .bottom-nav {
      position: absolute;
      left: 0;
      bottom: 0;
      height: 100px;
      width: 100%;
      background-color: #f4ff75;

      display: flex;
      align-items: center;
      justify-content: stretch;
      padding: 0;
    }

    .nav-item {
      flex: 1;
      height: 100%;
      background: none;
      border: none;
      cursor: pointer;

      font-family: "Carlito", sans-serif;
      font-size: 18px;
      font-weight: 600;
      color: #57a368;

      display: flex;
      align-items: center;
      justify-content: center;
    }

    .bottom-nav .nav-item,
    .bottom-nav .nav-item:focus,
    .bottom-nav .nav-item:active {
      background-color: transparent;
      box-shadow: none;
      outline: none;
    }

    .bottom-nav .nav-item.active {
      background-color: transparent;
      box-shadow: none;
      color: #57a368;
    }

    @media (max-width: 420px) {
      .content-scroll {
        padding-left: 16px;
        padding-right: 16px;
      }
    }
  </style>
</head>
<body>

<div class="wrapper-main">
  <div class="iphone-pro">
    <header class="top-bar">
      <div class="user-info">
        <div class="avatar-circle"></div>
        <span class="username">Username</span>
      </div>
    </header>

    <div class="top-divider"></div>


    <div class="plan-header-row">
      <div class="back-home" id="back-home">
        <span class="back-home-arrow">←</span>
        <span>Home</span>
      </div>
      <div class="plan-title-right">Plan</div>
    </div>

    <main class="content-scroll">

      <section class="calendar-card">
        <div class="calendar-title">Calendar</div>
        <div class="calendar-month-label" id="month-label">Month 2025</div>

        <div class="calendar-weekdays">
          <span>Mon</span>
          <span>Tue</span>
          <span>Wed</span>
          <span>Thu</span>
          <span>Fri</span>
          <span>Sat</span>
          <span>Sun</span>
        </div>

        <div class="calendar-grid" id="calendar-grid"></div>
      </section>


      <section>
        <h2 class="section-title">Current Goal:</h2>

        <div class="field-row">
          <div class="field-label">Starting Date:</div>
          <div class="field-value-box" id="current-start-box">( 11/13/2025 )</div>
        </div>

        <div class="field-row">
          <div class="field-label">Ending Date:</div>
          <div class="field-value-box" id="current-end-box">( 11/20/2025 )</div>
        </div>

        <div class="field-row">
          <div class="field-label">Distance/day:</div>
          <div class="field-value-box" id="current-distance-box">( 5 )km</div>
        </div>
      </section>

    
      <section>
        <h2 class="section-title" style="margin-top:32px;">Set a new goal:</h2>

        <div class="field-row">
          <div class="field-label">Starting Date:</div>
          <input type="date"
                 class="field-input"
                 id="new-start"
                 placeholder="(m/d/year)" />
        </div>

        <div class="field-row">
          <div class="field-label">Ending Date:</div>
          <input type="date"
                 class="field-input"
                 id="new-end"
                 placeholder="(m/d/year)" />
        </div>

        <div class="field-row">
          <div class="field-label">Distance/day:</div>
          <input type="number"
                 class="field-input"
                 id="new-distance"
                 placeholder="( )km" />
        </div>

        <div class="update-btn-wrapper">
          <button class="update-btn" id="update-goal-btn">Update</button>
        </div>
      </section>

    </main>


    <nav class="bottom-nav">
      <button class="nav-item nav-home" id="nav-home">
        Home
      </button>

      <button class="nav-item nav-run" id="nav-run">
        Run
      </button>

      <button class="nav-item nav-gallery" id="nav-gallery">
        Gallery
      </button>
    </nav>

  </div>
</div>

<script>
  function toDateOnly(d) {
    return new Date(d.getFullYear(), d.getMonth(), d.getDate());
  }

  function parseISODate(str) {
    if (!str) return null;
    const [y, m, d] = str.split("-").map(Number);
    if (!y || !m || !d) return null;
    return new Date(y, m - 1, d);
  }

  function formatMMDDYYYYFromISO(str) {
    const d = parseISODate(str);
    if (!d) return "";
    return d.toLocaleDateString("en-US");
  }

  const GOAL_KEY = "funrun_plan_current_goal";

  function loadCurrentGoal() {
    const stored = localStorage.getItem(GOAL_KEY);
    if (stored) {
      try {
        const obj = JSON.parse(stored);
        if (obj && obj.start && obj.end) return obj;
      } catch (e) {}
    }
    return {
      start: "2025-11-13",
      end: "2025-11-20",
      distance: "5"
    };
  }

  function saveCurrentGoal(goal) {
    localStorage.setItem(GOAL_KEY, JSON.stringify(goal));
  }

  let currentGoal = loadCurrentGoal();

  function refreshCurrentGoalBoxes() {
    const startBox = document.getElementById("current-start-box");
    const endBox   = document.getElementById("current-end-box");
    const distBox  = document.getElementById("current-distance-box");

    const startLabel = formatMMDDYYYYFromISO(currentGoal.start);
    const endLabel   = formatMMDDYYYYFromISO(currentGoal.end);

    startBox.textContent = startLabel ? `(${startLabel})` : "( )";
    endBox.textContent   = endLabel   ? `(${endLabel})`   : "( )";
    distBox.textContent  = currentGoal.distance
      ? `( ${currentGoal.distance} )km`
      : "( )km";
  }

  function buildCalendar() {
    const monthLabel = document.getElementById("month-label");
    const grid = document.getElementById("calendar-grid");

    const today = new Date();
    const todayDateOnly = toDateOnly(today);

    const monthName = today.toLocaleString("en-US", { month: "long" });
    monthLabel.textContent = monthName + " " + today.getFullYear();

    const dayOfWeek = (today.getDay() + 6) % 7;
    const start = new Date(todayDateOnly);
    start.setDate(todayDateOnly.getDate() - dayOfWeek - 7);

    const goalStart = parseISODate(currentGoal.start);
    const goalEnd   = parseISODate(currentGoal.end);

    grid.innerHTML = "";

    for (let i = 0; i < 21; i++) {
      const d = new Date(start);
      d.setDate(start.getDate() + i);
      const dOnly = toDateOnly(d);

      const cell = document.createElement("div");
      cell.className = "cal-day";
      cell.textContent = d.getDate();

      if (goalStart && goalEnd && dOnly >= goalStart && dOnly <= goalEnd) {
        cell.classList.add("goal-range");
      }

      if (dOnly.getTime() === todayDateOnly.getTime()) {
        cell.classList.add("today");
        cell.classList.remove("goal-range");
      }

      grid.appendChild(cell);
    }
  }


  refreshCurrentGoalBoxes();
  buildCalendar();


  (function initNewGoalInputs() {
    const startInput = document.getElementById("new-start");
    const endInput   = document.getElementById("new-end");
    const distInput  = document.getElementById("new-distance");

    startInput.value = currentGoal.start || "";
    endInput.value   = currentGoal.end   || "";
    distInput.value  = currentGoal.distance || "";
  })();

  document.getElementById("update-goal-btn").addEventListener("click", () => {
    const startInput = document.getElementById("new-start");
    const endInput   = document.getElementById("new-end");
    const distInput  = document.getElementById("new-distance");

    const newStart = startInput.value;
    const newEnd   = endInput.value;
    const newDist  = distInput.value;

    if (!newStart || !newEnd) {
      alert("Please select both a starting date and an ending date.");
      return;
    }

    const s = parseISODate(newStart);
    const e = parseISODate(newEnd);
    if (s && e && s > e) {
      alert("Starting date should not be later than ending date.");
      return;
    }

    currentGoal = {
      start: newStart,
      end: newEnd,
      distance: newDist || ""
    };

    saveCurrentGoal(currentGoal);
    refreshCurrentGoalBoxes();
    buildCalendar();
  });


  document.getElementById("back-home").addEventListener("click", () => {
    window.location.href = "homepage.html";
  });

  document.getElementById("nav-home").addEventListener("click", () => {
    window.location.href = "homepage.html";
  });

  document.getElementById("nav-run").addEventListener("click", () => {
    window.location.href = "runmode.html";
  });

  document.getElementById("nav-gallery").addEventListener("click", () => {
    window.location.href = "gallery.html";
  });
</script>

</body>
</html>