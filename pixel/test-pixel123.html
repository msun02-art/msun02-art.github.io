<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Emotion-based Pixel Art (11 moods)</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 16px;
      background: #fdfdf5;
    }
    #layout {
      display: flex;
      gap: 24px;
      align-items: flex-start;
    }
    #controls {
      min-width: 260px;
    }
    h3 {
      margin-top: 0;
      margin-bottom: 12px;
    }
    .slider-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 14px;
    }
    .slider-row span {
      width: 110px;
      flex-shrink: 0;
    }
    .slider-row input[type="range"] {
      flex: 1;
    }
    #smallcanvas {
      width: 340px;   /* CSS 尺寸 */
      height: 340px;
      border: 1px solid #ccc;
      background: #eee;
    }
    button {
      margin-top: 12px;
      padding: 6px 16px;
      border: none;
      cursor: pointer;
      background: #f4ff7a;
    }
  </style>
</head>
<body>
  <div id="layout">
    <!-- 左侧：11 个情绪 sliders -->
    <div id="controls">
      <h3>Mood after run</h3>

      <div class="slider-row">
        <span>Happy</span>
        <input id="mood-happy" type="range" min="0" max="100" value="60">
      </div>

      <div class="slider-row">
        <span>Accomplished</span>
        <input id="mood-accomplished" type="range" min="0" max="100" value="50">
      </div>

      <div class="slider-row">
        <span>Relieved</span>
        <input id="mood-relieved" type="range" min="0" max="100" value="40">
      </div>

      <div class="slider-row">
        <span>Energetic</span>
        <input id="mood-energetic" type="range" min="0" max="100" value="50">
      </div>

      <div class="slider-row">
        <span>Refreshed</span>
        <input id="mood-refreshed" type="range" min="0" max="100" value="40">
      </div>

      <div class="slider-row">
        <span>Calm</span>
        <input id="mood-calm" type="range" min="0" max="100" value="35">
      </div>

      <div class="slider-row">
        <span>Clear-headed</span>
        <input id="mood-clearHeaded" type="range" min="0" max="100" value="30">
      </div>

      <div class="slider-row">
        <span>Exhausted</span>
        <input id="mood-exhausted" type="range" min="0" max="100" value="20">
      </div>

      <div class="slider-row">
        <span>Sore</span>
        <input id="mood-sore" type="range" min="0" max="100" value="15">
      </div>

      <div class="slider-row">
        <span>Aching</span>
        <input id="mood-aching" type="range" min="0" max="100" value="10">
      </div>

      <div class="slider-row">
        <span>Irritable</span>
        <input id="mood-irritable" type="range" min="0" max="100" value="5">
      </div>

      <button id="generate">Generate art</button>
    </div>

    <!-- 右侧：pixel art canvas -->
    <canvas id="smallcanvas"></canvas>
  </div>

  <script>
    const smallCanvas = document.getElementById("smallcanvas");
    const small = smallCanvas.getContext("2d");

    /********** 配置：路线 & 画面 **********/
    const pixelSize = 8;         // 像素格大小
    const steps = 1500;          // 随机步数（点数）
    const stepRange = 10;        // 每步最大位移
    const backgroundColor = "#E0FFFE";

    // 11 个情绪，每个都由一个颜色变量控制
    const moods = {
      happy:        { color: "#FFE66D" }, // 明亮黄
      accomplished: { color: "#C8FF7A" }, // 温暖黄绿
      relieved:     { color: "#A4F3D5" }, // 浅蓝绿
      energetic:    { color: "#FFB347" }, // 橙色
      refreshed:    { color: "#7BE0AD" }, // 绿
      calm:         { color: "#7BC4FF" }, // 静蓝
      clearHeaded:  { color: "#D6E4FF" }, // 很淡的蓝
      exhausted:    { color: "#6B7A8F" }, // 灰蓝
      sore:         { color: "#C27BA0" }, // 紫粉
      aching:       { color: "#A35D6A" }, // 深红棕
      irritable:    { color: "#FF6B6B" }, // 红
    };

    /********** 基础工具 **********/

    function resizeCanvas() {
      smallCanvas.width  = smallCanvas.clientWidth;
      smallCanvas.height = smallCanvas.clientHeight;
    }

    // 随机游走路线（后面你可以换成真实跑步路线）
    function generateRoute() {
      const route = [];
      let x = smallCanvas.width / 2;
      let y = smallCanvas.height / 2;

      for (let i = 0; i < steps; i++) {
        x += Math.random() * stepRange * 2 - stepRange;
        y += Math.random() * stepRange * 2 - stepRange;
        route.push({ x, y });
      }
      return route;
    }

    // 读取 sliders → 得到每个情绪的权重
    function getMoodWeights() {
      const weights = {};
      let total = 0;

      for (const key of Object.keys(moods)) {
        const slider = document.getElementById("mood-" + key);
        const value = slider ? Number(slider.value) : 0;
        weights[key] = value;
        total += value;
      }

      // 如果全是 0，平均分配，避免除 0
      if (total === 0) {
        const n = Object.keys(moods).length;
        for (const key of Object.keys(moods)) {
          weights[key] = 1;
        }
        total = n;
      }

      return { weights, total };
    }

    // 按权重随机选择一个情绪颜色
    function pickColorByMood() {
      const { weights, total } = getMoodWeights();
      let r = Math.random() * total;

      for (const key of Object.keys(moods)) {
        r -= weights[key];
        if (r <= 0) {
          return moods[key].color;
        }
      }
      // 理论上不会走到这，兜底
      return moods.happy.color;
    }

    /********** 主函数：生成像素画 **********/

    function generatePixels() {
      resizeCanvas();

      // 背景
      small.fillStyle = backgroundColor;
      small.fillRect(0, 0, smallCanvas.width, smallCanvas.height);

      const route = generateRoute();

      for (let i = 0; i < route.length; i++) {
        const p = route[i];

        // 对齐到像素网格
        const px = Math.floor(p.x / pixelSize) * pixelSize;
        const py = Math.floor(p.y / pixelSize) * pixelSize;

        const color = pickColorByMood(); // ⭐ 关键：颜色由情绪控制

        small.fillStyle = color;
        small.fillRect(px, py, pixelSize, pixelSize);
      }
    }

    /********** 事件绑定 **********/

    document.getElementById("generate").onclick = generatePixels;

    // 所有 slider 改动时都重新生成
    for (const key of Object.keys(moods)) {
      const slider = document.getElementById("mood-" + key);
      slider.addEventListener("input", generatePixels);
    }

    window.addEventListener("resize", generatePixels);

    // 初次生成一张
    generatePixels();
  </script>
</body>
</html>